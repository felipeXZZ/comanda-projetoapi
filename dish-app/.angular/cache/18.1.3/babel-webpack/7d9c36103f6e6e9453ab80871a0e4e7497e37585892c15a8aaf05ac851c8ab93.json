{"ast":null,"code":"import { BehaviorSubject, map, tap } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let CartService = /*#__PURE__*/(() => {\n  class CartService {\n    http;\n    base = `${environment.apiUrl}/cart`;\n    _items$ = new BehaviorSubject([]);\n    items$ = this._items$.asObservable();\n    total$ = this.items$.pipe(map(items => items.reduce((s, it) => s + it.price * it.quantity, 0)));\n    constructor(http) {\n      this.http = http;\n    }\n    /** Carrega o carrinho do backend */\n    load() {\n      return this.http.get(this.base).pipe(tap(items => this._items$.next(items))).subscribe();\n    }\n    /** Adiciona item (ou incrementa quantidade no backend) */\n    add(productId, quantity = 1) {\n      return this.http.post(this.base, {\n        productId,\n        quantity\n      }).pipe(tap(items => this._items$.next(items))).subscribe();\n    }\n    /** Atualiza quantidade */\n    updateQty(itemId, quantity) {\n      return this.http.patch(`${this.base}/${itemId}`, {\n        quantity\n      }).pipe(tap(items => this._items$.next(items))).subscribe();\n    }\n    /** Remove item */\n    remove(itemId) {\n      return this.http.delete(`${this.base}/${itemId}`).pipe(tap(items => this._items$.next(items))).subscribe();\n    }\n    /** Limpa o carrinho */\n    clear() {\n      return this.http.delete(this.base).pipe(tap(items => this._items$.next(items))).subscribe();\n    }\n    /** Snapshot sincronizado (útil no submit) */\n    get itemsSnapshot() {\n      return this._items$.value;\n    }\n    static ɵfac = function CartService_Factory(ɵt) {\n      return new (ɵt || CartService)(i0.ɵɵinject(i1.HttpClient));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CartService,\n      factory: CartService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return CartService;\n})();","map":{"version":3,"names":["BehaviorSubject","map","tap","environment","CartService","http","base","apiUrl","_items$","items$","asObservable","total$","pipe","items","reduce","s","it","price","quantity","constructor","load","get","next","subscribe","add","productId","post","updateQty","itemId","patch","remove","delete","clear","itemsSnapshot","value","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\Gabriel Reis\\Desktop\\dish-app\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, map, tap } from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\n\r\nexport interface CartItem {\r\n  id: number;          // id do item no carrinho\r\n  productId: number;   // id do prato/produto real\r\n  name: string;\r\n  price: number;\r\n  quantity: number;\r\n}\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class CartService {\r\n  private readonly base = `${environment.apiUrl}/cart`;\r\n  private readonly _items$ = new BehaviorSubject<CartItem[]>([]);\r\n  readonly items$ = this._items$.asObservable();\r\n  readonly total$ = this.items$.pipe(\r\n    map(items => items.reduce((s, it) => s + it.price * it.quantity, 0))\r\n  );\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  /** Carrega o carrinho do backend */\r\n  load() {\r\n    return this.http.get<CartItem[]>(this.base).pipe(\r\n      tap(items => this._items$.next(items))\r\n    ).subscribe();\r\n  }\r\n\r\n  /** Adiciona item (ou incrementa quantidade no backend) */\r\n  add(productId: number, quantity = 1) {\r\n    return this.http.post<CartItem[]>(this.base, { productId, quantity }).pipe(\r\n      tap(items => this._items$.next(items))\r\n    ).subscribe();\r\n  }\r\n\r\n  /** Atualiza quantidade */\r\n  updateQty(itemId: number, quantity: number) {\r\n    return this.http.patch<CartItem[]>(`${this.base}/${itemId}`, { quantity }).pipe(\r\n      tap(items => this._items$.next(items))\r\n    ).subscribe();\r\n  }\r\n\r\n  /** Remove item */\r\n  remove(itemId: number) {\r\n    return this.http.delete<CartItem[]>(`${this.base}/${itemId}`).pipe(\r\n      tap(items => this._items$.next(items))\r\n    ).subscribe();\r\n  }\r\n\r\n  /** Limpa o carrinho */\r\n  clear() {\r\n    return this.http.delete<CartItem[]>(this.base).pipe(\r\n      tap(items => this._items$.next(items))\r\n    ).subscribe();\r\n  }\r\n\r\n  /** Snapshot sincronizado (útil no submit) */\r\n  get itemsSnapshot(): CartItem[] {\r\n    return this._items$.value;\r\n  }\r\n}\r\n"],"mappings":"AAEA,SAASA,eAAe,EAAEC,GAAG,EAAEC,GAAG,QAAQ,MAAM;AAChD,SAASC,WAAW,QAAQ,gCAAgC;;;AAW5D,WAAaC,WAAW;EAAlB,MAAOA,WAAW;IAQFC,IAAA;IAPHC,IAAI,GAAG,GAAGH,WAAW,CAACI,MAAM,OAAO;IACnCC,OAAO,GAAG,IAAIR,eAAe,CAAa,EAAE,CAAC;IACrDS,MAAM,GAAG,IAAI,CAACD,OAAO,CAACE,YAAY,EAAE;IACpCC,MAAM,GAAG,IAAI,CAACF,MAAM,CAACG,IAAI,CAChCX,GAAG,CAACY,KAAK,IAAIA,KAAK,CAACC,MAAM,CAAC,CAACC,CAAC,EAAEC,EAAE,KAAKD,CAAC,GAAGC,EAAE,CAACC,KAAK,GAAGD,EAAE,CAACE,QAAQ,EAAE,CAAC,CAAC,CAAC,CACrE;IAEDC,YAAoBd,IAAgB;MAAhB,KAAAA,IAAI,GAAJA,IAAI;IAAe;IAEvC;IACAe,IAAIA,CAAA;MACF,OAAO,IAAI,CAACf,IAAI,CAACgB,GAAG,CAAa,IAAI,CAACf,IAAI,CAAC,CAACM,IAAI,CAC9CV,GAAG,CAACW,KAAK,IAAI,IAAI,CAACL,OAAO,CAACc,IAAI,CAACT,KAAK,CAAC,CAAC,CACvC,CAACU,SAAS,EAAE;IACf;IAEA;IACAC,GAAGA,CAACC,SAAiB,EAAEP,QAAQ,GAAG,CAAC;MACjC,OAAO,IAAI,CAACb,IAAI,CAACqB,IAAI,CAAa,IAAI,CAACpB,IAAI,EAAE;QAAEmB,SAAS;QAAEP;MAAQ,CAAE,CAAC,CAACN,IAAI,CACxEV,GAAG,CAACW,KAAK,IAAI,IAAI,CAACL,OAAO,CAACc,IAAI,CAACT,KAAK,CAAC,CAAC,CACvC,CAACU,SAAS,EAAE;IACf;IAEA;IACAI,SAASA,CAACC,MAAc,EAAEV,QAAgB;MACxC,OAAO,IAAI,CAACb,IAAI,CAACwB,KAAK,CAAa,GAAG,IAAI,CAACvB,IAAI,IAAIsB,MAAM,EAAE,EAAE;QAAEV;MAAQ,CAAE,CAAC,CAACN,IAAI,CAC7EV,GAAG,CAACW,KAAK,IAAI,IAAI,CAACL,OAAO,CAACc,IAAI,CAACT,KAAK,CAAC,CAAC,CACvC,CAACU,SAAS,EAAE;IACf;IAEA;IACAO,MAAMA,CAACF,MAAc;MACnB,OAAO,IAAI,CAACvB,IAAI,CAAC0B,MAAM,CAAa,GAAG,IAAI,CAACzB,IAAI,IAAIsB,MAAM,EAAE,CAAC,CAAChB,IAAI,CAChEV,GAAG,CAACW,KAAK,IAAI,IAAI,CAACL,OAAO,CAACc,IAAI,CAACT,KAAK,CAAC,CAAC,CACvC,CAACU,SAAS,EAAE;IACf;IAEA;IACAS,KAAKA,CAAA;MACH,OAAO,IAAI,CAAC3B,IAAI,CAAC0B,MAAM,CAAa,IAAI,CAACzB,IAAI,CAAC,CAACM,IAAI,CACjDV,GAAG,CAACW,KAAK,IAAI,IAAI,CAACL,OAAO,CAACc,IAAI,CAACT,KAAK,CAAC,CAAC,CACvC,CAACU,SAAS,EAAE;IACf;IAEA;IACA,IAAIU,aAAaA,CAAA;MACf,OAAO,IAAI,CAACzB,OAAO,CAAC0B,KAAK;IAC3B;;wBAhDW9B,WAAW,EAAA+B,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;IAAA;;aAAXlC,WAAW;MAAAmC,OAAA,EAAXnC,WAAW,CAAAoC,IAAA;MAAAC,UAAA,EADE;IAAM;;SACnBrC,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}