{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Validators, ReactiveFormsModule } from '@angular/forms';\nimport { map } from 'rxjs/operators';\nlet CheckoutComponent = class CheckoutComponent {\n  fb;\n  cartService;\n  pedidoService;\n  router;\n  customerForm;\n  items$; // \"Ouvinte\" para os itens do carrinho\n  total$; // \"Ouvinte\" para o total do carrinho\n  totalItensNoCarrinho$;\n  isLoading = false;\n  error = null;\n  successMessage = null;\n  constructor(fb, cartService, pedidoService, router) {\n    this.fb = fb;\n    this.cartService = cartService;\n    this.pedidoService = pedidoService;\n    this.router = router;\n    // Inicializa o formulário do cliente\n    this.customerForm = this.fb.group({\n      nomeCliente: ['', Validators.required],\n      telefoneCliente: ['', Validators.required],\n      enderecoCliente: ['', Validators.required]\n    });\n    // Conecta os Observables do serviço ao nosso componente\n    this.items$ = this.cartService.items$;\n    this.total$ = this.cartService.total$;\n    this.totalItensNoCarrinho$ = this.cartService.items$.pipe(map(items => items.reduce((total, item) => total + item.quantidade, 0)));\n  }\n  ngOnInit() {\n    // Se o carrinho estiver vazio, redireciona para o cardápio\n    if (this.cartService.getCurrentItems().length === 0) {\n      this.router.navigate(['/']); // (Vamos mudar para '/menu' depois)\n    }\n  }\n  // Chamado quando o cliente clica em \"Finalizar Pedido\"\n  onSubmit() {\n    if (this.customerForm.invalid) {\n      this.customerForm.markAllAsTouched();\n      return;\n    }\n    if (this.cartService.getCurrentItems().length === 0) {\n      this.error = \"Seu carrinho está vazio!\";\n      return;\n    }\n    this.isLoading = true;\n    this.error = null;\n    this.successMessage = null;\n    // 1. Formata os itens do carrinho para o formato que o Backend (Java) espera\n    const itensParaApi = this.cartService.getCurrentItems().map(item => ({\n      dish: {\n        id: item.dish.id\n      },\n      // Envia apenas o ID do prato\n      quantidade: item.quantidade\n    }));\n    // 2. Monta o objeto Pedido completo\n    const novoPedido = {\n      ...this.customerForm.value,\n      // Pega (nome, telefone, endereco) do formulário\n      itens: itensParaApi\n    };\n    console.log('Enviando pedido para a API:', novoPedido);\n    // 3. Chama o PedidoService para enviar ao backend\n    this.pedidoService.createPedido(novoPedido).subscribe({\n      next: pedidoSalvo => {\n        console.log('Pedido criado com sucesso!', pedidoSalvo);\n        this.successMessage = `Pedido #${pedidoSalvo.id} realizado com sucesso! Em breve sairá para entrega.`;\n        this.isLoading = false;\n        this.cartService.clearCart(); // Limpa o carrinho\n        this.customerForm.reset();\n        // (No futuro, podemos navegar para uma tela de \"Obrigado\" ou \"Rastreamento\")\n        // setTimeout(() => this.router.navigate(['/']), 5000);\n      },\n      error: err => {\n        console.error('Erro ao criar pedido:', err);\n        this.error = 'Não foi possível finalizar o pedido. Tente novamente.';\n        this.isLoading = false;\n      }\n    });\n  }\n  // --- Funções Auxiliares para o HTML ---\n  isFieldInvalid(fieldName) {\n    const control = this.customerForm.get(fieldName);\n    return control ? control.invalid && (control.dirty || control.touched) : false;\n  }\n};\nCheckoutComponent = __decorate([Component({\n  selector: 'app-checkout',\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule // Precisamos de formulários reativos aqui\n  ],\n  templateUrl: './checkout.component.html',\n  styleUrls: ['./checkout.component.css']\n})], CheckoutComponent);\nexport { CheckoutComponent };","map":{"version":3,"names":["Component","CommonModule","Validators","ReactiveFormsModule","map","CheckoutComponent","fb","cartService","pedidoService","router","customerForm","items$","total$","totalItensNoCarrinho$","isLoading","error","successMessage","constructor","group","nomeCliente","required","telefoneCliente","enderecoCliente","pipe","items","reduce","total","item","quantidade","ngOnInit","getCurrentItems","length","navigate","onSubmit","invalid","markAllAsTouched","itensParaApi","dish","id","novoPedido","value","itens","console","log","createPedido","subscribe","next","pedidoSalvo","clearCart","reset","err","isFieldInvalid","fieldName","control","get","dirty","touched","__decorate","selector","standalone","imports","templateUrl","styleUrls"],"sources":["C:\\Users\\jvgam\\OneDrive\\Área de Trabalho\\ComandaProjeto\\dish-app\\dish-app\\src\\app\\components\\checkout\\checkout.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';\r\nimport { Router } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n// Nossos serviços\r\nimport { CartService, CartItem } from '../../services/dish.service';\r\nimport { PedidoService, ItemPedido, Pedido } from '../../services/pedido.service';\r\n\r\n@Component({\r\n  selector: 'app-checkout',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule // Precisamos de formulários reativos aqui\r\n  ],\r\n  templateUrl: './checkout.component.html',\r\n  styleUrls: ['./checkout.component.css']\r\n})\r\nexport class CheckoutComponent implements OnInit {\r\n\r\n  customerForm: FormGroup;\r\n  items$: Observable<CartItem[]>; // \"Ouvinte\" para os itens do carrinho\r\n  total$: Observable<number>;     // \"Ouvinte\" para o total do carrinho\r\n  totalItensNoCarrinho$: Observable<number>;\r\n\r\n  isLoading = false;\r\n  error: string | null = null;\r\n  successMessage: string | null = null;\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private cartService: CartService,\r\n    private pedidoService: PedidoService,\r\n    private router: Router\r\n  ) {\r\n    // Inicializa o formulário do cliente\r\n    this.customerForm = this.fb.group({\r\n      nomeCliente: ['', Validators.required],\r\n      telefoneCliente: ['', Validators.required],\r\n      enderecoCliente: ['', Validators.required]\r\n    });\r\n    // Conecta os Observables do serviço ao nosso componente\r\n    this.items$ = this.cartService.items$;\r\n    this.total$ = this.cartService.total$;\r\n    this.totalItensNoCarrinho$ = this.cartService.items$.pipe(\r\n      map((items: CartItem[]) => items.reduce((total: number, item: CartItem) => total + item.quantidade, 0))\r\n    );\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // Se o carrinho estiver vazio, redireciona para o cardápio\r\n    if (this.cartService.getCurrentItems().length === 0) {\r\n      this.router.navigate(['/']); // (Vamos mudar para '/menu' depois)\r\n    }\r\n  }\r\n\r\n  // Chamado quando o cliente clica em \"Finalizar Pedido\"\r\n  onSubmit(): void {\r\n    if (this.customerForm.invalid) {\r\n      this.customerForm.markAllAsTouched();\r\n      return;\r\n    }\r\n\r\n    if (this.cartService.getCurrentItems().length === 0) {\r\n      this.error = \"Seu carrinho está vazio!\";\r\n      return;\r\n    }\r\n\r\n    this.isLoading = true;\r\n    this.error = null;\r\n    this.successMessage = null;\r\n\r\n    // 1. Formata os itens do carrinho para o formato que o Backend (Java) espera\r\n    const itensParaApi: ItemPedido[] = this.cartService.getCurrentItems().map(item => ({\r\n      dish: { id: item.dish.id! }, // Envia apenas o ID do prato\r\n      quantidade: item.quantidade\r\n    }));\r\n\r\n    // 2. Monta o objeto Pedido completo\r\n    const novoPedido: Pedido = {\r\n      ...this.customerForm.value, // Pega (nome, telefone, endereco) do formulário\r\n      itens: itensParaApi\r\n    };\r\n\r\n    console.log('Enviando pedido para a API:', novoPedido);\r\n\r\n    // 3. Chama o PedidoService para enviar ao backend\r\n    this.pedidoService.createPedido(novoPedido).subscribe({\r\n      next: (pedidoSalvo) => {\r\n        console.log('Pedido criado com sucesso!', pedidoSalvo);\r\n        this.successMessage = `Pedido #${pedidoSalvo.id} realizado com sucesso! Em breve sairá para entrega.`;\r\n        this.isLoading = false;\r\n        this.cartService.clearCart(); // Limpa o carrinho\r\n        this.customerForm.reset();\r\n\r\n        // (No futuro, podemos navegar para uma tela de \"Obrigado\" ou \"Rastreamento\")\r\n        // setTimeout(() => this.router.navigate(['/']), 5000);\r\n      },\r\n      error: (err) => {\r\n        console.error('Erro ao criar pedido:', err);\r\n        this.error = 'Não foi possível finalizar o pedido. Tente novamente.';\r\n        this.isLoading = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  // --- Funções Auxiliares para o HTML ---\r\n  isFieldInvalid(fieldName: string): boolean {\r\n    const control = this.customerForm.get(fieldName);\r\n    return control ? control.invalid && (control.dirty || control.touched) : false;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}