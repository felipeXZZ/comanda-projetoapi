{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Validators, ReactiveFormsModule } from '@angular/forms';\nimport { RouterLink } from '@angular/router'; // <-- MUDANÇA 1: Importar RouterLink\nimport { TopbarComponent } from '../topbar/topbar.component';\nlet CheckoutComponent = class CheckoutComponent {\n  fb;\n  cartService;\n  pedidoService;\n  router;\n  customerForm;\n  items$;\n  total$;\n  isLoading = false;\n  error = null;\n  successMessage = null;\n  constructor(fb, cartService, pedidoService, router) {\n    this.fb = fb;\n    this.cartService = cartService;\n    this.pedidoService = pedidoService;\n    this.router = router;\n    // Inicializa o formulário do cliente\n    this.customerForm = this.fb.group({\n      nomeCliente: ['', Validators.required],\n      telefoneCliente: ['', Validators.required],\n      enderecoCliente: ['', Validators.required]\n    });\n    // Conecta os Observables do serviço ao nosso componente\n    this.items$ = this.cartService.items$;\n    this.total$ = this.cartService.total$;\n  }\n  ngOnInit() {}\n  // Chamado quando o cliente clica em \"Finalizar Pedido\"\n  onSubmit() {\n    if (this.customerForm.invalid) {\n      this.customerForm.markAllAsTouched();\n      return;\n    }\n    if (this.cartService.getCurrentItems().length === 0) {\n      this.error = \"Seu carrinho está vazio!\";\n      return;\n    }\n    this.isLoading = true;\n    this.error = null;\n    this.successMessage = null;\n    // 1. Formata os itens do carrinho para o formato que o Backend (Java) espera\n    const itensParaApi = this.cartService.getCurrentItems().map(item => ({\n      dish: {\n        id: item.dish.id\n      },\n      // Envia apenas o ID do prato\n      quantidade: item.quantidade\n    }));\n    // 2. Monta o objeto Pedido completo\n    const novoPedido = {\n      ...this.customerForm.value,\n      // Pega (nome, telefone, endereco) do formulário\n      itens: itensParaApi\n    };\n    console.log('Enviando pedido para a API:', novoPedido);\n    // 3. Chama o PedidoService para enviar ao backend\n    this.pedidoService.createPedido(novoPedido).subscribe({\n      next: pedidoSalvo => {\n        console.log('Pedido criado com sucesso!', pedidoSalvo);\n        this.successMessage = `Pedido #${pedidoSalvo.id} realizado com sucesso! Em breve sairá para entrega.`;\n        this.isLoading = false;\n        this.cartService.clearCart(); // Limpa o carrinho\n        this.customerForm.reset();\n      },\n      error: err => {\n        console.error('Erro ao criar pedido:', err);\n        this.error = 'Não foi possível finalizar o pedido. Tente novamente.';\n        this.isLoading = false;\n      }\n    });\n  }\n  aumentar(item) {\n    this.cartService.addItem(item.dish, 1);\n  }\n  diminuir(item) {\n    if (item.dish.id) {\n      this.cartService.decreaseQuantity(item.dish.id);\n    }\n  }\n  remover(item) {\n    if (item.dish.id) {\n      this.cartService.removeItem(item.dish.id);\n    }\n  }\n  // --- Funções Auxiliares para o HTML ---\n  isFieldInvalid(fieldName) {\n    const control = this.customerForm.get(fieldName);\n    return control ? control.invalid && (control.dirty || control.touched) : false;\n  }\n};\nCheckoutComponent = __decorate([Component({\n  selector: 'app-checkout',\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule, TopbarComponent, RouterLink // <-- MUDANÇA 2: Adicionar RouterLink aqui\n  ],\n  templateUrl: './checkout.component.html',\n  styleUrls: ['./checkout.component.css']\n})], CheckoutComponent);\nexport { CheckoutComponent };","map":{"version":3,"names":["Component","CommonModule","Validators","ReactiveFormsModule","RouterLink","TopbarComponent","CheckoutComponent","fb","cartService","pedidoService","router","customerForm","items$","total$","isLoading","error","successMessage","constructor","group","nomeCliente","required","telefoneCliente","enderecoCliente","ngOnInit","onSubmit","invalid","markAllAsTouched","getCurrentItems","length","itensParaApi","map","item","dish","id","quantidade","novoPedido","value","itens","console","log","createPedido","subscribe","next","pedidoSalvo","clearCart","reset","err","aumentar","addItem","diminuir","decreaseQuantity","remover","removeItem","isFieldInvalid","fieldName","control","get","dirty","touched","__decorate","selector","standalone","imports","templateUrl","styleUrls"],"sources":["C:\\Users\\jvgam\\OneDrive\\Área de Trabalho\\ComandaProjeto\\dish-app\\dish-app\\src\\app\\components\\checkout\\checkout.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';\r\nimport { Router, RouterLink } from '@angular/router'; // <-- MUDANÇA 1: Importar RouterLink\r\nimport { Observable } from 'rxjs';\r\nimport { TopbarComponent } from '../topbar/topbar.component';\r\n\r\n// Nossos serviços\r\nimport { CartService, CartItem } from '../../services/cart.service';\r\nimport { PedidoService, ItemPedido, Pedido } from '../../services/pedido.service';\r\n\r\n@Component({\r\n  selector: 'app-checkout',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    TopbarComponent,\r\n    RouterLink // <-- MUDANÇA 2: Adicionar RouterLink aqui\r\n  ],\r\n  templateUrl: './checkout.component.html',\r\n  styleUrls: ['./checkout.component.css']\r\n})\r\nexport class CheckoutComponent implements OnInit {\r\n\r\n  customerForm: FormGroup;\r\n  items$: Observable<CartItem[]>;\r\n  total$: Observable<number>;\r\n\r\n  isLoading = false;\r\n  error: string | null = null;\r\n  successMessage: string | null = null;\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private cartService: CartService,\r\n    private pedidoService: PedidoService,\r\n    private router: Router\r\n  ) {\r\n    // Inicializa o formulário do cliente\r\n    this.customerForm = this.fb.group({\r\n      nomeCliente: ['', Validators.required],\r\n      telefoneCliente: ['', Validators.required],\r\n      enderecoCliente: ['', Validators.required]\r\n    });\r\n\r\n    // Conecta os Observables do serviço ao nosso componente\r\n    this.items$ = this.cartService.items$;\r\n    this.total$ = this.cartService.total$;\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    \r\n  }\r\n\r\n  // Chamado quando o cliente clica em \"Finalizar Pedido\"\r\n  onSubmit(): void {\r\n    if (this.customerForm.invalid) {\r\n      this.customerForm.markAllAsTouched();\r\n      return;\r\n    }\r\n\r\n    if (this.cartService.getCurrentItems().length === 0) {\r\n      this.error = \"Seu carrinho está vazio!\";\r\n      return;\r\n    }\r\n\r\n    this.isLoading = true;\r\n    this.error = null;\r\n    this.successMessage = null;\r\n\r\n    // 1. Formata os itens do carrinho para o formato que o Backend (Java) espera\r\n    const itensParaApi: ItemPedido[] = this.cartService.getCurrentItems().map(item => ({\r\n      dish: { id: item.dish.id! }, // Envia apenas o ID do prato\r\n      quantidade: item.quantidade\r\n    }));\r\n\r\n    // 2. Monta o objeto Pedido completo\r\n    const novoPedido: Pedido = {\r\n      ...this.customerForm.value, // Pega (nome, telefone, endereco) do formulário\r\n      itens: itensParaApi\r\n    };\r\n\r\n    console.log('Enviando pedido para a API:', novoPedido);\r\n\r\n    // 3. Chama o PedidoService para enviar ao backend\r\n    this.pedidoService.createPedido(novoPedido).subscribe({\r\n      next: (pedidoSalvo) => {\r\n        console.log('Pedido criado com sucesso!', pedidoSalvo);\r\n        this.successMessage = `Pedido #${pedidoSalvo.id} realizado com sucesso! Em breve sairá para entrega.`;\r\n        this.isLoading = false;\r\n        this.cartService.clearCart(); // Limpa o carrinho\r\n        this.customerForm.reset();\r\n      },\r\n      error: (err) => {\r\n        console.error('Erro ao criar pedido:', err);\r\n        this.error = 'Não foi possível finalizar o pedido. Tente novamente.';\r\n        this.isLoading = false;\r\n      }\r\n    });\r\n  }\r\n  aumentar(item: CartItem): void {\r\n    this.cartService.addItem(item.dish, 1);\r\n  }\r\n\r\n  diminuir(item: CartItem): void {\r\n    if (item.dish.id) {\r\n      this.cartService.decreaseQuantity(item.dish.id);\r\n    }\r\n  }\r\n\r\n  remover(item: CartItem): void {\r\n    if (item.dish.id) {\r\n      this.cartService.removeItem(item.dish.id);\r\n    }\r\n  }\r\n  \r\n  // --- Funções Auxiliares para o HTML ---\r\n  isFieldInvalid(fieldName: string): boolean {\r\n    const control = this.customerForm.get(fieldName);\r\n    return control ? control.invalid && (control.dirty || control.touched) : false;\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}